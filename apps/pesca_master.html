<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pesca Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #87CEEB;
            overflow: hidden;
            touch-action: manipulation;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        #map {
            position: absolute;
            width: 2000px;
            height: 2000px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="2000" height="2000" viewBox="0 0 2000 2000"><rect width="2000" height="2000" fill="%2344aadd"/><circle cx="300" cy="300" r="200" fill="%23228855"/><circle cx="800" cy="500" r="150" fill="%23228855"/><circle cx="1200" cy="300" r="180" fill="%23228855"/><circle cx="500" cy="1200" r="250" fill="%23228855"/><circle cx="1500" cy="800" r="300" fill="%23228855"/><circle cx="1700" cy="1700" r="400" fill="%23116644"/></svg>');
            transform: translate(0, 0);
            transition: transform 0.3s ease-out;
        }

        #player {
            position: absolute;
            width: 60px;
            height: 60px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23ff6347"/><circle cx="35" cy="40" r="5" fill="%23333"/><circle cx="65" cy="40" r="5" fill="%23333"/><path d="M30,65 Q50,80 70,65" stroke="%23333" stroke-width="3" fill="none"/></svg>');
            background-size: contain;
            z-index: 10;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #fishing-rod {
            position: absolute;
            width: 80px;
            height: 5px;
            background-color: #8B4513;
            top: 50%;
            left: 50%;
            transform-origin: left center;
            transform: rotate(-45deg);
            z-index: 9;
        }

        #fishing-line {
            position: absolute;
            width: 2px;
            background-color: white;
            transform-origin: top center;
            z-index: 8;
        }

        #fishing-hook {
            position: absolute;
            width: 10px;
            height: 10px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10"><path d="M5,0 L5,8 Q5,10 7,8" stroke="%23ccc" stroke-width="0.5" fill="none"/></svg>');
            background-size: contain;
            z-index: 7;
        }

        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 100;
        }

        #money-display, #inventory-btn, #upgrades-btn, #achievements-btn {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
        }

        #money-display {
            display: flex;
            align-items: center;
        }

        #money-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="%23FFD700"/><text x="12" y="16" font-size="12" text-anchor="middle" fill="%23800000">$</text></svg>');
            background-size: contain;
        }

        #ui-buttons {
            display: flex;
            gap: 10px;
        }

        #fishing-minigame {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 400px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        #fishing-bar {
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, red, red 20%, yellow 20%, yellow 50%, green 50%, green 100%);
            border-radius: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        #fishing-indicator {
            position: absolute;
            width: 4px;
            height: 100%;
            background-color: white;
            left: 0;
            top: 0;
        }

        #fishing-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        #aiming-ui {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 400px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        #aiming-bar {
            width: 100%;
            height: 30px;
            background: linear-gradient(to right, #555, #ccc, #555);
            border-radius: 15px;
            margin-bottom: 10px;
            position: relative;
            overflow: hidden;
        }

        #aiming-indicator {
            position: absolute;
            width: 4px;
            height: 100%;
            background-color: white;
            left: 50%;
            top: 0;
        }

        #aiming-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        #fish-caught-ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 200;
            color: white;
            text-align: center;
        }

        #fish-caught-image {
            width: 100px;
            height: 100px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-bottom: 10px;
        }

        #modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }

        .modal {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .inventory-item, .upgrade-item, .achievement-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .item-image {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .item-info {
            flex-grow: 1;
            padding: 0 10px;
        }

        .item-name {
            font-weight: bold;
        }

        .item-value {
            color: #666;
            font-size: 0.9rem;
        }

        .item-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .achievement-item {
            opacity: 0.5;
        }

        .achievement-unlocked {
            opacity: 1;
        }

        .achievement-icon {
            width: 30px;
            height: 30px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-right: 10px;
        }

        .achievement-info {
            flex-grow: 1;
        }

        .achievement-name {
            font-weight: bold;
        }

        .achievement-description {
            font-size: 0.8rem;
            color: #666;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            touch-action: manipulation;
        }

        #joystick-area {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 100px;
            height: 100px;
            display: none;
            z-index: 100;
        }

        #joystick {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            position: absolute;
            top: 20px;
            left: 20px;
        }

        @media (max-width: 768px) {
            #controls {
                display: flex;
            }
            
            #joystick-area {
                display: block;
            }
        }

        #location-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="map"></div>
        <div id="player"></div>
        <div id="fishing-rod"></div>
        <div id="fishing-line"></div>
        <div id="fishing-hook"></div>
        
        <div id="ui-container">
            <div id="money-display">
                <div id="money-icon"></div>
                <span id="money-amount">100</span>
            </div>
            <div id="ui-buttons">
                <div id="inventory-btn">Invent√°rio</div>
                <div id="upgrades-btn">Melhorias</div>
                <div id="achievements-btn">Conquistas</div>
            </div>
        </div>
        
        <div id="fishing-minigame">
            <div id="fishing-bar">
                <div id="fishing-indicator"></div>
            </div>
            <button id="fishing-button">Pescar!</button>
        </div>
        
        <div id="aiming-ui">
            <div id="aiming-bar">
                <div id="aiming-indicator"></div>
            </div>
            <button id="aiming-button">Lan√ßar!</button>
        </div>
        
        <div id="fish-caught-ui">
            <div id="fish-caught-image"></div>
            <h3 id="fish-caught-name"></h3>
            <p id="fish-caught-value"></p>
            <button id="fish-caught-ok">OK</button>
        </div>
        
        <div id="location-info">Lago Pequeno</div>
        
        <div id="controls">
            <div class="control-btn" id="fish-btn">üé£</div>
            <div class="control-btn" id="up-btn">‚Üë</div>
            <div class="control-btn" id="left-btn">‚Üê</div>
            <div class="control-btn" id="down-btn">‚Üì</div>
            <div class="control-btn" id="right-btn">‚Üí</div>
        </div>
        
        <div id="joystick-area">
            <div id="joystick"></div>
        </div>
        
        <div id="modal-overlay">
            <div class="modal" id="inventory-modal">
                <div class="modal-header">
                    <div class="modal-title">Invent√°rio</div>
                    <button class="close-modal">&times;</button>
                </div>
                <div id="inventory-items"></div>
            </div>
            
            <div class="modal" id="upgrades-modal">
                <div class="modal-header">
                    <div class="modal-title">Melhorias</div>
                    <button class="close-modal">&times;</button>
                </div>
                <div id="upgrades-items"></div>
            </div>
            
            <div class="modal" id="achievements-modal">
                <div class="modal-header">
                    <div class="modal-title">Conquistas</div>
                    <button class="close-modal">&times;</button>
                </div>
                <div id="achievements-items"></div>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            money: 100,
            inventory: [],
            upgrades: {
                rodSpeed: 1,
                playerSpeed: 1,
                boatSpeed: 1,
                hookRange: 1
            },
            achievements: {
                firstCatch: false,
                rareCatch: false,
                masterAngler: false,
                money1000: false,
                allFish: false
            },
            currentLocation: 'small-lake',
            isFishing: false,
            isAiming: false,
            playerPosition: { x: 1000, y: 1000 },
            mapOffset: { x: window.innerWidth / 2 - 1000, y: window.innerHeight / 2 - 1000 },
            joystickActive: false,
            joystickAngle: 0
        };

        // Fish Data
        const fishData = {
            'small-lake': [
                { name: 'Til√°pia', value: 10, rarity: 0.6, image: 'üêü' },
                { name: 'Carpa', value: 15, rarity: 0.4, image: 'üê†' },
                { name: 'Bagre', value: 20, rarity: 0.3, image: 'üê°' }
            ],
            'medium-lake': [
                { name: 'Perca', value: 25, rarity: 0.5, image: 'üêü' },
                { name: 'Truta', value: 30, rarity: 0.4, image: 'üê†' },
                { name: 'Salm√£o', value: 50, rarity: 0.2, image: 'üê°' }
            ],
            'large-lake': [
                { name: 'Salm√£o Grande', value: 70, rarity: 0.4, image: 'üêü' },
                { name: 'Atum', value: 90, rarity: 0.3, image: 'üê†' },
                { name: 'Peixe-Espada', value: 120, rarity: 0.1, image: 'üê°' }
            ],
            'ocean': [
                { name: 'Tubar√£o', value: 200, rarity: 0.2, image: 'ü¶à' },
                { name: 'Baleia', value: 500, rarity: 0.05, image: 'üêã' },
                { name: 'Peixe Dourado', value: 1000, rarity: 0.01, image: 'üê†' }
            ]
        };

        // Locations
        const locations = {
            'small-lake': { name: 'Lago Pequeno', x: 300, y: 300, radius: 200 },
            'medium-lake': { name: 'Lago M√©dio', x: 800, y: 500, radius: 150 },
            'large-lake': { name: 'Lago Grande', x: 500, y: 1200, radius: 250 },
            'ocean': { name: 'Oceano', x: 1700, y: 1700, radius: 400 }
        };

        // Upgrades Data
        const upgradesData = [
            { id: 'rod-speed', name: 'Velocidade da Vara', description: 'Aumenta a velocidade da vara de pescar', price: 50, maxLevel: 5, property: 'rodSpeed' },
            { id: 'player-speed', name: 'Velocidade do Pesquisador', description: 'Aumenta a velocidade de movimento', price: 30, maxLevel: 5, property: 'playerSpeed' },
            { id: 'boat-speed', name: 'Velocidade do Barco', description: 'Aumenta a velocidade no barco', price: 100, maxLevel: 3, property: 'boatSpeed' },
            { id: 'hook-range', name: 'Alcance do Anzol', description: 'Aumenta o alcance do anzol', price: 80, maxLevel: 4, property: 'hookRange' }
        ];

        // Achievements Data
        const achievementsData = [
            { id: 'first-catch', name: 'Primeira Pesca', description: 'Pegue seu primeiro peixe', icon: 'üé£' },
            { id: 'rare-catch', name: 'Pescador Sortudo', description: 'Pegue um peixe raro', icon: 'üçÄ' },
            { id: 'master-angler', name: 'Mestre Pesquisador', description: 'Pegue 20 peixes', icon: 'üèÜ' },
            { id: 'money1000', name: 'Rico', description: 'Tenha 1000 moedas', icon: 'üí∞' },
            { id: 'all-fish', name: 'Colecionador', description: 'Pegue todos os tipos de peixe', icon: 'üìä' }
        ];

        // DOM Elements
        const elements = {
            gameContainer: document.getElementById('game-container'),
            map: document.getElementById('map'),
            player: document.getElementById('player'),
            fishingRod: document.getElementById('fishing-rod'),
            fishingLine: document.getElementById('fishing-line'),
            fishingHook: document.getElementById('fishing-hook'),
            moneyDisplay: document.getElementById('money-amount'),
            inventoryBtn: document.getElementById('inventory-btn'),
            upgradesBtn: document.getElementById('upgrades-btn'),
            achievementsBtn: document.getElementById('achievements-btn'),
            fishingMinigame: document.getElementById('fishing-minigame'),
            fishingBar: document.getElementById('fishing-bar'),
            fishingIndicator: document.getElementById('fishing-indicator'),
            fishingButton: document.getElementById('fishing-button'),
            aimingUi: document.getElementById('aiming-ui'),
            aimingBar: document.getElementById('aiming-bar'),
            aimingIndicator: document.getElementById('aiming-indicator'),
            aimingButton: document.getElementById('aiming-button'),
            fishCaughtUi: document.getElementById('fish-caught-ui'),
            fishCaughtImage: document.getElementById('fish-caught-image'),
            fishCaughtName: document.getElementById('fish-caught-name'),
            fishCaughtValue: document.getElementById('fish-caught-value'),
            fishCaughtOk: document.getElementById('fish-caught-ok'),
            modalOverlay: document.getElementById('modal-overlay'),
            inventoryModal: document.getElementById('inventory-modal'),
            upgradesModal: document.getElementById('upgrades-modal'),
            achievementsModal: document.getElementById('achievements-modal'),
            inventoryItems: document.getElementById('inventory-items'),
            upgradesItems: document.getElementById('upgrades-items'),
            achievementsItems: document.getElementById('achievements-items'),
            locationInfo: document.getElementById('location-info'),
            controls: document.getElementById('controls'),
            fishBtn: document.getElementById('fish-btn'),
            upBtn: document.getElementById('up-btn'),
            leftBtn: document.getElementById('left-btn'),
            downBtn: document.getElementById('down-btn'),
            rightBtn: document.getElementById('right-btn'),
            joystickArea: document.getElementById('joystick-area'),
            joystick: document.getElementById('joystick')
        };

        // Game Variables
        let fishingInterval;
        let aimingInterval;
        let indicatorDirection = 1;
        let indicatorSpeed = 5;
        let currentFish = null;
        let fishCaughtCount = 0;
        let caughtFishTypes = new Set();

        // Initialize Game
        function initGame() {
            updateMoneyDisplay();
            renderMap();
            setupEventListeners();
            checkMobileControls();
        }

        // Render Map
        function renderMap() {
            elements.map.style.transform = `translate(${gameState.mapOffset.x}px, ${gameState.mapOffset.y}px)`;
        }

        // Update Money Display
        function updateMoneyDisplay() {
            elements.moneyDisplay.textContent = gameState.money;
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Keyboard Controls
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // Fishing Button
            elements.fishingButton.addEventListener('click', handleFishingClick);
            
            // Aiming Button
            elements.aimingButton.addEventListener('click', handleAimingClick);
            
            // Fish Caught OK Button
            elements.fishCaughtOk.addEventListener('click', () => {
                elements.fishCaughtUi.style.display = 'none';
            });
            
            // Modal Buttons
            elements.inventoryBtn.addEventListener('click', () => openModal('inventory'));
            elements.upgradesBtn.addEventListener('click', () => openModal('upgrades'));
            elements.achievementsBtn.addEventListener('click', () => openModal('achievements'));
            
            // Close Modal Buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', closeModal);
            });
            
            // Mobile Controls
            elements.fishBtn.addEventListener('click', startFishing);
            
            // Joystick Controls
            setupJoystick();
            
            // Window Resize
            window.addEventListener('resize', checkMobileControls);
        }

        // Handle Key Down
        function handleKeyDown(e) {
            if (gameState.isFishing || gameState.isAiming) return;
            
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    movePlayer(0, -1);
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    movePlayer(-1, 0);
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    movePlayer(0, 1);
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    movePlayer(1, 0);
                    break;
                case ' ':
                case 'f':
                case 'F':
                    startFishing();
                    break;
            }
        }

        // Handle Key Up
        function handleKeyUp(e) {
            // Can add key up logic if needed
        }

        // Move Player
        function movePlayer(dx, dy) {
            const speed = 5 * gameState.upgrades.playerSpeed;
            const newX = gameState.playerPosition.x + dx * speed;
            const newY = gameState.playerPosition.y + dy * speed;
            
            // Check boundaries
            if (newX >= 0 && newX <= 2000) {
                gameState.playerPosition.x = newX;
            }
            if (newY >= 0 && newY <= 2000) {
                gameState.playerPosition.y = newY;
            }
            
            // Update map offset
            gameState.mapOffset.x = window.innerWidth / 2 - gameState.playerPosition.x;
            gameState.mapOffset.y = window.innerHeight / 2 - gameState.playerPosition.y;
            
            renderMap();
            updateCurrentLocation();
            updateFishingRodPosition();
        }

        // Update Current Location
        function updateCurrentLocation() {
            let newLocation = 'land';
            let locationName = 'Terra';
            
            for (const [id, loc] of Object.entries(locations)) {
                const distance = Math.sqrt(
                    Math.pow(gameState.playerPosition.x - loc.x, 2) + 
                    Math.pow(gameState.playerPosition.y - loc.y, 2)
                );
                
                if (distance <= loc.radius) {
                    newLocation = id;
                    locationName = loc.name;
                    break;
                }
            }
            
            if (gameState.currentLocation !== newLocation) {
                gameState.currentLocation = newLocation;
                elements.locationInfo.textContent = locationName;
            }
        }

        // Update Fishing Rod Position
        function updateFishingRodPosition() {
            const angle = gameState.joystickActive ? gameState.joystickAngle : -45;
            elements.fishingRod.style.transform = `rotate(${angle}deg)`;
        }

        // Start Fishing
        function startFishing() {
            if (gameState.isFishing || gameState.isAiming) return;
            
            if (gameState.currentLocation === 'land') {
                alert('Voc√™ precisa estar na √°gua para pescar!');
                return;
            }
            
            startAiming();
        }

        // Start Aiming
        function startAiming() {
            gameState.isAiming = true;
            elements.aimingUi.style.display = 'flex';
            
            let position = 50;
            let direction = 1;
            const speed = 2 + gameState.upgrades.rodSpeed;
            
            aimingInterval = setInterval(() => {
                position += direction * speed;
                
                if (position >= 100) {
                    position = 100;
                    direction = -1;
                } else if (position <= 0) {
                    position = 0;
                    direction = 1;
                }
                
                elements.aimingIndicator.style.left = `${position}%`;
            }, 20);
        }

        // Handle Aiming Click
        function handleAimingClick() {
            if (!gameState.isAiming) return;
            
            clearInterval(aimingInterval);
            gameState.isAiming = false;
            elements.aimingUi.style.display = 'none';
            
            // Calculate accuracy based on aiming position
            const indicatorPos = parseFloat(elements.aimingIndicator.style.left || '50');
            const accuracy = 1 - Math.abs(50 - indicatorPos) / 50;
            
            startFishingMinigame(accuracy);
        }

        // Start Fishing Minigame
        function startFishingMinigame(accuracy) {
            gameState.isFishing = true;
            elements.fishingMinigame.style.display = 'flex';
            
            let position = 0;
            indicatorDirection = 1;
            indicatorSpeed = 3 + Math.random() * 2 * gameState.upgrades.rodSpeed;
            
            fishingInterval = setInterval(() => {
                position += indicatorDirection * indicatorSpeed;
                
                if (position >= 100) {
                    position = 100;
                    indicatorDirection = -1;
                } else if (position <= 0) {
                    position = 0;
                    indicatorDirection = 1;
                }
                
                elements.fishingIndicator.style.left = `${position}%`;
            }, 20);
            
            // Set timeout for fish bite
            const biteTime = 2000 + Math.random() * 3000 / accuracy;
            
            setTimeout(() => {
                if (gameState.isFishing) {
                    fishBite(accuracy);
                }
            }, biteTime);
        }

        // Fish Bite
        function fishBite(accuracy) {
            // Select a fish based on location and rarity
            const possibleFish = fishData[gameState.currentLocation];
            let totalRarity = possibleFish.reduce((sum, fish) => sum + fish.rarity, 0);
            
            let random = Math.random() * totalRarity * accuracy;
            let selectedFish = null;
            
            for (const fish of possibleFish) {
                if (random < fish.rarity) {
                    selectedFish = fish;
                    break;
                }
                random -= fish.rarity;
            }
            
            if (!selectedFish) {
                selectedFish = possibleFish[0];
            }
            
            currentFish = selectedFish;
            
            // Change button text
            elements.fishingButton.textContent = 'Pegar!';
        }

        // Handle Fishing Click
        function handleFishingClick() {
            if (!gameState.isFishing) return;
            
            if (currentFish) {
                // Try to catch the fish
                const indicatorPos = parseFloat(elements.fishingIndicator.style.left || '0');
                let catchChance = 1;
                
                if (indicatorPos < 20) {
                    // Red zone - low chance
                    catchChance = 0.3;
                } else if (indicatorPos < 50) {
                    // Yellow zone - medium chance
                    catchChance = 0.7;
                }
                // Green zone - 100% chance
                
                if (Math.random() < catchChance) {
                    // Fish caught!
                    catchFish(currentFish);
                } else {
                    // Fish escaped
                    alert(`O ${currentFish.name} escapou!`);
                }
            }
            
            // Reset fishing
            endFishing();
        }

        // Catch Fish
        function catchFish(fish) {
            gameState.inventory.push(fish);
            gameState.money += fish.value;
            fishCaughtCount++;
            caughtFishTypes.add(fish.name);
            
            // Update UI
            updateMoneyDisplay();
            
            // Show caught fish UI
            elements.fishCaughtImage.textContent = fish.image;
            elements.fishCaughtName.textContent = fish.name;
            elements.fishCaughtValue.textContent = `Valor: $${fish.value}`;
            elements.fishCaughtUi.style.display = 'flex';
            
            // Check achievements
            checkAchievements(fish);
        }

        // Check Achievements
        function checkAchievements(fish) {
            // First catch
            if (!gameState.achievements.firstCatch && fishCaughtCount >= 1) {
                gameState.achievements.firstCatch = true;
                showAchievementNotification('Primeira Pesca');
            }
            
            // Rare catch
            if (!gameState.achievements.rareCatch && fish.rarity <= 0.2) {
                gameState.achievements.rareCatch = true;
                showAchievementNotification('Pescador Sortudo');
            }
            
            // Master angler
            if (!gameState.achievements.masterAngler && fishCaughtCount >= 20) {
                gameState.achievements.masterAngler = true;
                showAchievementNotification('Mestre Pesquisador');
            }
            
            // Money 1000
            if (!gameState.achievements.money1000 && gameState.money >= 1000) {
                gameState.achievements.money1000 = true;
                showAchievementNotification('Rico');
            }
            
            // All fish
            const currentLocationFish = fishData[gameState.currentLocation];
            if (!gameState.achievements.allFish && 
                currentLocationFish.every(f => caughtFishTypes.has(f.name))) {
                gameState.achievements.allFish = true;
                showAchievementNotification('Colecionador');
            }
        }

        // Show Achievement Notification
        function showAchievementNotification(name) {
            const notification = document.createElement('div');
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = 'rgba(255, 215, 0, 0.9)';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '20px';
            notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            notification.style.zIndex = '1000';
            notification.style.display = 'flex';
            notification.style.alignItems = 'center';
            notification.style.gap = '10px';
            notification.innerHTML = `
                <span style="font-size: 24px;">üèÜ</span>
                <div>
                    <div style="font-weight: bold;">Conquista Desbloqueada!</div>
                    <div>${name}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transition = 'opacity 1s';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 1000);
            }, 3000);
        }

        // End Fishing
        function endFishing() {
            clearInterval(fishingInterval);
            gameState.isFishing = false;
            currentFish = null;
            elements.fishingMinigame.style.display = 'none';
            elements.fishingButton.textContent = 'Pescar!';
        }

        // Open Modal
        function openModal(type) {
            elements.modalOverlay.style.display = 'flex';
            
            switch(type) {
                case 'inventory':
                    elements.inventoryModal.style.display = 'block';
                    renderInventory();
                    break;
                case 'upgrades':
                    elements.upgradesModal.style.display = 'block';
                    renderUpgrades();
                    break;
                case 'achievements':
                    elements.achievementsModal.style.display = 'block';
                    renderAchievements();
                    break;
            }
        }

        // Close Modal
        function closeModal() {
            elements.modalOverlay.style.display = 'none';
            elements.inventoryModal.style.display = 'none';
            elements.upgradesModal.style.display = 'none';
            elements.achievementsModal.style.display = 'none';
        }

        // Render Inventory
        function renderInventory() {
            elements.inventoryItems.innerHTML = '';
            
            if (gameState.inventory.length === 0) {
                elements.inventoryItems.innerHTML = '<p style="text-align: center;">Seu invent√°rio est√° vazio</p>';
                return;
            }
            
            // Group fish by type
            const fishCounts = {};
            gameState.inventory.forEach(fish => {
                if (!fishCounts[fish.name]) {
                    fishCounts[fish.name] = { count: 0, fish: fish };
                }
                fishCounts[fish.name].count++;
            });
            
            // Create inventory items
            for (const [name, data] of Object.entries(fishCounts)) {
                const item = document.createElement('div');
                item.className = 'inventory-item';
                item.innerHTML = `
                    <div class="item-image">${data.fish.image}</div>
                    <div class="item-info">
                        <div class="item-name">${name}</div>
                        <div class="item-value">Quantidade: ${data.count}</div>
                    </div>
                    <button class="item-button sell-btn" data-value="${data.fish.value}" data-name="${name}">Vender ($${data.fish.value})</button>
                `;
                elements.inventoryItems.appendChild(item);
            }
            
            // Add sell event listeners
            document.querySelectorAll('.sell-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const value = parseInt(btn.dataset.value);
                    const name = btn.dataset.name;
                    
                    // Find and remove one fish of this type
                    const index = gameState.inventory.findIndex(f => f.name === name);
                    if (index !== -1) {
                        gameState.inventory.splice(index, 1);
                        gameState.money += value;
                        updateMoneyDisplay();
                        renderInventory();
                    }
                });
            });
        }

        // Render Upgrades
        function renderUpgrades() {
            elements.upgradesItems.innerHTML = '';
            
            upgradesData.forEach(upgrade => {
                const currentLevel = gameState.upgrades[upgrade.property];
                const maxReached = currentLevel >= upgrade.maxLevel;
                const nextPrice = upgrade.price * (currentLevel + 1);
                
                const item = document.createElement('div');
                item.className = 'upgrade-item';
                item.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${upgrade.name} (N√≠vel ${currentLevel}/${upgrade.maxLevel})</div>
                        <div class="item-value">${upgrade.description}</div>
                    </div>
                    <button class="item-button upgrade-btn" 
                            data-id="${upgrade.id}" 
                            data-property="${upgrade.property}"
                            ${maxReached || gameState.money < nextPrice ? 'disabled' : ''}>
                        ${maxReached ? 'M√°x.' : `Melhorar ($${nextPrice})`}
                    </button>
                `;
                elements.upgradesItems.appendChild(item);
            });
            
            // Add upgrade event listeners
            document.querySelectorAll('.upgrade-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.dataset.id;
                    const property = btn.dataset.property;
                    const upgrade = upgradesData.find(u => u.id === id);
                    const nextPrice = upgrade.price * (gameState.upgrades[property] + 1);
                    
                    if (gameState.money >= nextPrice) {
                        gameState.money -= nextPrice;
                        gameState.upgrades[property]++;
                        updateMoneyDisplay();
                        renderUpgrades();
                    }
                });
            });
        }

        // Render Achievements
        function renderAchievements() {
            elements.achievementsItems.innerHTML = '';
            
            achievementsData.forEach(achievement => {
                const unlocked = gameState.achievements[achievement.id.replace('-', '')];
                
                const item = document.createElement('div');
                item.className = `achievement-item ${unlocked ? 'achievement-unlocked' : ''}`;
                item.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-description">${achievement.description}</div>
                    </div>
                    <div>${unlocked ? '‚úîÔ∏è' : 'üîí'}</div>
                `;
                elements.achievementsItems.appendChild(item);
            });
        }

        // Check Mobile Controls
        function checkMobileControls() {
            if (window.innerWidth <= 768) {
                elements.controls.style.display = 'flex';
                elements.joystickArea.style.display = 'block';
            } else {
                elements.controls.style.display = 'none';
                elements.joystickArea.style.display = 'none';
            }
        }

        // Setup Joystick
        function setupJoystick() {
            let joystickStart = null;
            
            elements.joystickArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = elements.joystickArea.getBoundingClientRect();
                joystickStart = {
                    x: rect.left + rect.width / 2,
                    y: rect.top + rect.height / 2
                };
                gameState.joystickActive = true;
            });
            
            document.addEventListener('touchmove', (e) => {
                if (!joystickStart) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const dx = touch.clientX - joystickStart.x;
                const dy = touch.clientY - joystickStart.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const maxDistance = 40;
                
                if (distance > maxDistance) {
                    const angle = Math.atan2(dy, dx);
                    const limitedX = Math.cos(angle) * maxDistance;
                    const limitedY = Math.sin(angle) * maxDistance;
                    
                    elements.joystick.style.transform = `translate(${limitedX}px, ${limitedY}px)`;
                    
                    // Calculate angle (0 = right, 90 = down, 180 = left, 270 = up)
                    gameState.joystickAngle = (angle * 180 / Math.PI + 360) % 360;
                    updateFishingRodPosition();
                    
                    // Determine movement direction
                    const moveAngle = (gameState.joystickAngle + 45) % 360; // Adjust for fishing rod angle
                    
                    // Convert angle to movement vector
                    let moveX = 0, moveY = 0;
                    
                    if (moveAngle > 315 || moveAngle <= 45) {
                        moveX = 1; // Right
                    } else if (moveAngle > 45 && moveAngle <= 135) {
                        moveY = 1; // Down
                    } else if (moveAngle > 135 && moveAngle <= 225) {
                        moveX = -1; // Left
                    } else {
                        moveY = -1; // Up
                    }
                    
                    movePlayer(moveX, moveY);
                } else {
                    elements.joystick.style.transform = `translate(${dx}px, ${dy}px)`;
                    
                    // Calculate angle
                    gameState.joystickAngle = Math.atan2(dy, dx) * 180 / Math.PI;
                    updateFishingRodPosition();
                }
            });
            
            document.addEventListener('touchend', () => {
                if (!joystickStart) return;
                
                elements.joystick.style.transform = 'translate(0, 0)';
                joystickStart = null;
                gameState.joystickActive = false;
                updateFishingRodPosition();
            });
        }

        // Initialize the game
        window.onload = initGame;
    </script>
</body>
</html>
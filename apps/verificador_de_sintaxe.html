<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verificador de Sintaxe HTML</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
            --warning-color: #f39c12;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: #333;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-color);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .description {
            color: #666;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .upload-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .file-input-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--card-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .file-input-container h2 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            font-size: 1.2rem;
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        .file-input label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .file-input input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .results {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .result-card {
            flex: 1;
            min-width: 300px;
            background-color: var(--card-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .result-card h2 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status.valid {
            background-color: var(--success-color);
            color: white;
        }
        
        .status.invalid {
            background-color: var(--error-color);
            color: white;
        }
        
        .error-list {
            list-style-type: none;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .error-item {
            padding: 10px;
            border-left: 4px solid var(--error-color);
            margin-bottom: 10px;
            background-color: #ffeeee;
        }
        
        .error-line {
            font-weight: bold;
            color: var(--error-color);
        }
        
        .code-preview {
            margin-top: 30px;
            background-color: var(--card-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .code-preview h2 {
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .code-line {
            display: block;
            min-height: 20px;
        }
        
        .line-number {
            display: inline-block;
            width: 40px;
            color: #888;
            text-align: right;
            margin-right: 10px;
            user-select: none;
        }
        
        .highlight {
            background-color: #fffacd;
        }
        
        .error-marker {
            color: var(--error-color);
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .upload-section, .results {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Verificador de Sintaxe HTML</h1>
            <p class="description">
                Esta ferramenta verifica erros de sintaxe em arquivos HTML, incluindo CSS e JavaScript embutidos.
                Selecione os arquivos para verificar e clique no botão de verificação.
            </p>
        </header>
        
        <div class="upload-section">
            <div class="file-input-container">
                <h2>Arquivos para Verificar</h2>
                <div class="file-input">
                    <label for="logon-file">logon.html</label>
                    <input type="file" id="logon-file" accept=".html">
                </div>
                <div class="file-input">
                    <label for="home-file">home.html</label>
                    <input type="file" id="home-file" accept=".html">
                </div>
                <div class="file-input">
                    <label for="index-file">index.html</label>
                    <input type="file" id="index-file" accept=".html">
                </div>
                <button id="verify-btn">Verificar Sintaxe</button>
            </div>
        </div>
        
        <div class="results">
            <div class="result-card">
                <h2>logon.html <span class="status" id="logon-status">Não verificado</span></h2>
                <ul class="error-list" id="logon-errors">
                    <li class="error-item">Nenhum arquivo verificado ainda</li>
                </ul>
            </div>
            
            <div class="result-card">
                <h2>home.html <span class="status" id="home-status">Não verificado</span></h2>
                <ul class="error-list" id="home-errors">
                    <li class="error-item">Nenhum arquivo verificado ainda</li>
                </ul>
            </div>
            
            <div class="result-card">
                <h2>index.html <span class="status" id="index-status">Não verificado</span></h2>
                <ul class="error-list" id="index-errors">
                    <li class="error-item">Nenhum arquivo verificado ainda</li>
                </ul>
            </div>
        </div>
        
        <div class="code-preview">
            <h2>Visualização do Código: <span id="current-file">Nenhum arquivo selecionado</span></h2>
            <div id="code-container">
                <pre id="code-content">Selecione um arquivo para visualizar o código</pre>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const verifyBtn = document.getElementById('verify-btn');
            const fileInputs = {
                'logon': document.getElementById('logon-file'),
                'home': document.getElementById('home-file'),
                'index': document.getElementById('index-file')
            };
            
            const statusElements = {
                'logon': document.getElementById('logon-status'),
                'home': document.getElementById('home-status'),
                'index': document.getElementById('index-status')
            };
            
            const errorLists = {
                'logon': document.getElementById('logon-errors'),
                'home': document.getElementById('home-errors'),
                'index': document.getElementById('index-errors')
            };
            
            const codeContent = document.getElementById('code-content');
            const currentFileElement = document.getElementById('current-file');
            
            // Função para verificar a sintaxe HTML
            function checkHTMLSyntax(htmlString, fileName) {
                const errors = [];
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlString, 'text/html');
                
                // Verificar erros de parsing
                const parserErrors = doc.querySelectorAll('parsererror');
                if (parserErrors.length > 0) {
                    parserErrors.forEach(error => {
                        const errorText = error.textContent;
                        let lineMatch = errorText.match(/line (\d+)/i);
                        let line = lineMatch ? parseInt(lineMatch[1]) : 0;
                        
                        errors.push({
                            line: line,
                            message: errorText.split('\n')[0] // Primeira linha da mensagem de erro
                        });
                    });
                }
                
                // Verificar tags não fechadas (simplificado)
                const openTags = [];
                const lines = htmlString.split('\n');
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    const tagMatches = line.match(/<([^>]+)>/g) || [];
                    
                    for (let tag of tagMatches) {
                        if (tag.startsWith('</')) {
                            // Tag de fechamento
                            const tagName = tag.match(/<\/([^\s>]+)/);
                            if (tagName && openTags.length > 0 && openTags[openTags.length - 1] === tagName[1]) {
                                openTags.pop();
                            }
                        } else if (!tag.endsWith('/>') && !tag.match(/<(br|hr|img|input|meta|link)/i)) {
                            // Tag de abertura (excluindo tags auto-fechadas)
                            const tagName = tag.match(/<([^\s>\/]+)/);
                            if (tagName) {
                                openTags.push(tagName[1]);
                            }
                        }
                    }
                }
                
                if (openTags.length > 0) {
                    errors.push({
                        line: lines.length,
                        message: `Possível tag não fechada: ${openTags[openTags.length - 1]}`
                    });
                }
                
                // Verificar scripts com sintaxe JavaScript
                const scriptTags = doc.querySelectorAll('script');
                scriptTags.forEach((script, index) => {
                    if (script.src) return; // Ignorar scripts externos
                    
                    try {
                        new Function(script.textContent);
                    } catch (e) {
                        // Tentar encontrar a linha do script no HTML original
                        const scriptContent = script.textContent;
                        const allScripts = htmlString.match(/<script[^>]*>([\s\S]*?)<\/script>/gi) || [];
                        let scriptPosition = 0;
                        
                        for (let i = 0; i < allScripts.length; i++) {
                            if (i === index) break;
                            scriptPosition += allScripts[i].length;
                        }
                        
                        const linesBeforeScript = htmlString.substring(0, scriptPosition).split('\n');
                        const scriptLine = linesBeforeScript.length;
                        
                        errors.push({
                            line: scriptLine,
                            message: `Erro no script: ${e.message}`
                        });
                    }
                });
                
                // Verificar estilos CSS
                const styleTags = doc.querySelectorAll('style');
                styleTags.forEach((style, index) => {
                    try {
                        // Tentativa básica de verificação de CSS
                        const cssContent = style.textContent;
                        // Verificar chaves desbalanceadas
                        const openBraces = (cssContent.match(/{/g) || []).length;
                        const closeBraces = (cssContent.match(/}/g) || []).length;
                        
                        if (openBraces !== closeBraces) {
                            const allStyles = htmlString.match(/<style[^>]*>([\s\S]*?)<\/style>/gi) || [];
                            let stylePosition = 0;
                            
                            for (let i = 0; i < allStyles.length; i++) {
                                if (i === index) break;
                                stylePosition += allStyles[i].length;
                            }
                            
                            const linesBeforeStyle = htmlString.substring(0, stylePosition).split('\n');
                            const styleLine = linesBeforeStyle.length;
                            
                            errors.push({
                                line: styleLine,
                                message: `Chaves desbalanceadas no CSS: {=${openBraces} vs }=${closeBraces}`
                            });
                        }
                    } catch (e) {
                        // Em caso de erro na verificação CSS
                        const allStyles = htmlString.match(/<style[^>]*>([\s\S]*?)<\/style>/gi) || [];
                        let stylePosition = 0;
                        
                        for (let i = 0; i < allStyles.length; i++) {
                            if (i === index) break;
                            stylePosition += allStyles[i].length;
                        }
                        
                        const linesBeforeStyle = htmlString.substring(0, stylePosition).split('\n');
                        const styleLine = linesBeforeStyle.length;
                        
                        errors.push({
                            line: styleLine,
                            message: `Erro no CSS: ${e.message}`
                        });
                    }
                });
                
                return errors;
            }
            
            // Função para exibir erros
            function displayErrors(fileName, errors) {
                const errorList = errorLists[fileName];
                const statusElement = statusElements[fileName];
                
                errorList.innerHTML = '';
                
                if (errors.length === 0) {
                    statusElement.textContent = 'Válido';
                    statusElement.className = 'status valid';
                    errorList.innerHTML = '<li class="error-item">Nenhum erro de sintaxe encontrado</li>';
                } else {
                    statusElement.textContent = `${errors.length} erro(s)`;
                    statusElement.className = 'status invalid';
                    
                    errors.forEach(error => {
                        const li = document.createElement('li');
                        li.className = 'error-item';
                        li.innerHTML = `
                            <div class="error-line">Linha ${error.line}:</div>
                            <div>${error.message}</div>
                        `;
                        errorList.appendChild(li);
                    });
                }
            }
            
            // Função para exibir o código com numeração de linhas
            function displayCode(content, fileName) {
                currentFileElement.textContent = fileName;
                
                const lines = content.split('\n');
                let codeHTML = '';
                
                lines.forEach((line, index) => {
                    codeHTML += `<div class="code-line"><span class="line-number">${index + 1}</span> ${escapeHTML(line)}</div>`;
                });
                
                codeContent.innerHTML = codeHTML;
            }
            
            // Função auxiliar para escapar HTML
            function escapeHTML(html) {
                return html.replace(/&/g, "&amp;")
                          .replace(/</g, "&lt;")
                          .replace(/>/g, "&gt;")
                          .replace(/"/g, "&quot;")
                          .replace(/'/g, "&#039;");
            }
            
            // Event listener para o botão de verificação
            verifyBtn.addEventListener('click', function() {
                for (const fileName in fileInputs) {
                    const fileInput = fileInputs[fileName];
                    const file = fileInput.files[0];
                    
                    if (file) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const content = e.target.result;
                            const errors = checkHTMLSyntax(content, fileName);
                            
                            displayErrors(fileName, errors);
                            displayCode(content, `${fileName}.html`);
                        };
                        
                        reader.readAsText(file);
                    } else {
                        displayErrors(fileName, [{line: 0, message: 'Nenhum arquivo selecionado'}]);
                    }
                }
            });
            
            // Event listeners para mostrar o código quando um arquivo é selecionado
            for (const fileName in fileInputs) {
                fileInputs[fileName].addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const content = e.target.result;
                            displayCode(content, `${fileName}.html`);
                        };
                        
                        reader.readAsText(file);
                    }
                });
            }
        });
    </script>
</body>
</html>
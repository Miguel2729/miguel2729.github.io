<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aplicativo de Desenho Básico</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    touch-action: none;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    overflow: hidden;
}

.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100vw;
}

.toolbar {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background-color: #333;
    color: white;
    gap: 10px;
}

.tool-section {
    display: flex;
    align-items: center;
    gap: 10px;
}

.tool-btn {
    background-color: #444;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.2s;
}

.tool-btn:hover {
    background-color: #555;
}

.tool-btn.active {
    background-color: #007bff;
}

#color-picker {
    width: 40px;
    height: 40px;
    padding: 0;
    border: none;
    background: none;
    cursor: pointer;
}

#size-slider {
    width: 100px;
    cursor: pointer;
}

#size-value {
    min-width: 40px;
    text-align: center;
}

.canvas-container {
    flex-grow: 1;
    overflow: hidden;
    background-color: white;
}

#drawing-canvas {
    display: block;
    background-color: white;
    cursor: crosshair;
    touch-action: none;
}

@media (max-width: 600px) {
    .toolbar {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .tool-section {
        width: 100%;
        justify-content: space-between;
    }
}
</style>
</head>
<body>
    <div class="app-container">
        <div class="toolbar">
            <div class="tool-section">
                <button class="tool-btn active" id="pencil" title="Lápis"><i class="fas fa-pencil-alt"></i></button>
                <button class="tool-btn" id="brush" title="Pincel"><i class="fas fa-paint-brush"></i></button>
                <button class="tool-btn" id="eraser" title="Borracha"><i class="fas fa-eraser"></i></button>
                <button class="tool-btn" id="line" title="Linha"><i class="fas fa-minus"></i></button>
                <button class="tool-btn" id="rectangle" title="Retângulo"><i class="far fa-square"></i></button>
                <button class="tool-btn" id="circle" title="Círculo"><i class="far fa-circle"></i></button>
            </div>
            <div class="tool-section">
                <input type="color" id="color-picker" value="#000000" title="Cor">
                <input type="range" id="size-slider" min="1" max="50" value="5" title="Tamanho">
                <span id="size-value">5px</span>
            </div>
            <div class="tool-section">
                <button class="tool-btn" id="clear" title="Limpar Tela"><i class="fas fa-trash-alt"></i></button>
                <button class="tool-btn" id="save" title="Salvar Desenho"><i class="fas fa-save"></i></button>
                <button class="tool-btn" id="undo" title="Desfazer"><i class="fas fa-undo"></i></button>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="drawing-canvas"></canvas>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    const canvas = document.getElementById('drawing-canvas');
    const ctx = canvas.getContext('2d');
    const colorPicker = document.getElementById('color-picker');
    const sizeSlider = document.getElementById('size-slider');
    const sizeValue = document.getElementById('size-value');
    const clearBtn = document.getElementById('clear');
    const saveBtn = document.getElementById('save');
    const undoBtn = document.getElementById('undo');
    const toolButtons = document.querySelectorAll('.tool-btn:not(#clear):not(#save):not(#undo)');
    
    // Ajustar tamanho do canvas
    function resizeCanvas() {
        const container = canvas.parentElement;
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }
    
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    
    // Estado do aplicativo
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let currentTool = 'pencil';
    let snapshots = [];
    let snapshotIndex = -1;
    
    // Atualizar exibição do tamanho
    sizeSlider.addEventListener('input', function() {
        sizeValue.textContent = `${this.value}px`;
    });
    
    // Seleção de ferramentas
    toolButtons.forEach(button => {
        button.addEventListener('click', function() {
            toolButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentTool = this.id;
        });
    });
    
    // Eventos de desenho (mouse)
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // Eventos de desenho (touch)
    canvas.addEventListener('touchstart', handleTouch);
    canvas.addEventListener('touchmove', handleTouch);
    canvas.addEventListener('touchend', stopDrawing);
    
    function handleTouch(e) {
    e.preventDefault();
    const touch = e.touches[0];
    const rect = canvas.getBoundingClientRect();
    const mouseEvent = {
        clientX: touch.clientX,
        clientY: touch.clientY,
        target: touch.target
    };
    
    if (e.type === 'touchstart') {
        startDrawing(mouseEvent);
    } else if (e.type === 'touchmove') {
        draw(mouseEvent);
    }
}
    
    function startDrawing(e) {
    isDrawing = true;
    
    // Obter coordenadas corretas considerando a posição do canvas
    const rect = canvas.getBoundingClientRect();
    lastX = e.clientX - rect.left;
    lastY = e.clientY - rect.top;
    
    // Salvar snapshot antes de começar a desenhar
    if (currentTool !== 'undo') {
        saveSnapshot();
    }
}

function draw(e) {
    if (!isDrawing) return;
    
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : colorPicker.value;
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    ctx.lineWidth = sizeSlider.value;
    
    switch(currentTool) {
        case 'pencil':
        case 'brush':
        case 'eraser':
            ctx.globalCompositeOperation = currentTool === 'eraser' ? 'destination-out' : 'source-over';
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            [lastX, lastY] = [x, y];
            break;
            
        case 'line':
            restoreSnapshot();
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            break;
            
        case 'rectangle':
            restoreSnapshot();
            ctx.strokeRect(lastX, lastY, x - lastX, y - lastY);
            break;
            
        case 'circle':
            restoreSnapshot();
            const radius = Math.sqrt(Math.pow(x - lastX, 2) + Math.pow(y - lastY, 2));
            ctx.beginPath();
            ctx.arc(lastX, lastY, radius, 0, Math.PI * 2);
            ctx.stroke();
            break;
    }
}
    
    function stopDrawing() {
        isDrawing = false;
    }
    
    // Limpar canvas
    clearBtn.addEventListener('click', function() {
        if (confirm('Tem certeza que deseja limpar o canvas?')) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            snapshots = [];
            snapshotIndex = -1;
        }
    });
    
    // Salvar desenho
    saveBtn.addEventListener('click', function() {
        const link = document.createElement('a');
        link.download = 'desenho.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
    
    // Desfazer
    undoBtn.addEventListener('click', function() {
        if (snapshotIndex > 0) {
            snapshotIndex--;
            const snapshot = snapshots[snapshotIndex];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(snapshot, 0, 0);
        } else if (snapshotIndex === 0) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            snapshotIndex = -1;
        }
    });
    
    // Gerenciamento de snapshots
    function saveSnapshot() {
        // Limpar snapshots futuros se estivermos no meio da lista
        if (snapshotIndex < snapshots.length - 1) {
            snapshots = snapshots.slice(0, snapshotIndex + 1);
        }
        
        const snapshot = new Image();
        snapshot.src = canvas.toDataURL();
        snapshots.push(snapshot);
        snapshotIndex = snapshots.length - 1;
        
        // Limitar o número de snapshots para evitar uso excessivo de memória
        if (snapshots.length > 20) {
            snapshots.shift();
            snapshotIndex--;
        }
    }
    
    function restoreSnapshot() {
        if (snapshotIndex >= 0) {
            const snapshot = snapshots[snapshotIndex];
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(snapshot, 0, 0);
        }
    }
});
</script>
</body>
</html>